<div class="dialog-container">
  <h2 mat-dialog-title>Zakaži novi termin</h2>

  <form [formGroup]="appointmentForm" (ngSubmit)="onSubmit()">
    <mat-dialog-content>
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Lokacija</mat-label>
        <mat-select formControlName="facility" (selectionChange)="onFacilityChange($event.value)">
          <mat-option *ngFor="let facility of facilities" [value]="facility._id">
            {{ facility.name }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="appointmentForm.get('facility')?.hasError('required')">
          Obavezno polje
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Zaposleni</mat-label>
        <mat-select formControlName="employee" [disabled]="employees.length === 0">
          <mat-option *ngFor="let employee of employees" [value]="employee._id">
            {{ employee.firstName }} {{ employee.lastName }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="appointmentForm.get('employee')?.hasError('required')">
          Obavezno polje
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Usluga</mat-label>
        <mat-select formControlName="service" (selectionChange)="onServiceChange()">
          <mat-option *ngFor="let service of services" [value]="service._id">
            {{ service.name }} ({{ service.durationMinutes }}min, {{ service.price }} RSD)
          </mat-option>
        </mat-select>
        <mat-error *ngIf="appointmentForm.get('service')?.hasError('required')">
          Obavezno polje
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Datum</mat-label>
        <input matInput type="date" formControlName="date" min="{{ today }}">
        <mat-error *ngIf="appointmentForm.get('date')?.hasError('required')">
          Obavezno polje
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Vreme</mat-label>
        <mat-select formControlName="startHour" (selectionChange)="onServiceChange()">
          <mat-option *ngFor="let slot of timeSlots" [value]="slot">
            {{ slot }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="appointmentForm.get('startHour')?.hasError('required')">
          Obavezno polje
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Završetak</mat-label>
        <input matInput formControlName="endHour" readonly>
      </mat-form-field>
    </mat-dialog-content>

    <mat-dialog-actions align="end">
      <button mat-button type="button" (click)="onCancel()">Otkaži</button>
      <button mat-raised-button color="primary" type="submit" [disabled]="appointmentForm.invalid || loading">
        <span *ngIf="loading">Zakazivanje...</span>
        <span *ngIf="!loading">Zakaži termin</span>
      </button>
    </mat-dialog-actions>
  </form>
</div>
