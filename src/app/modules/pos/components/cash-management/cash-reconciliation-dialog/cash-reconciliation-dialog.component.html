<div class="cash-reconciliation-dialog">
  <!-- Dialog Content -->
  <div class="dialog-content">
    
    <!-- Loading Spinner -->
    <div *ngIf="loading" class="loading-container">
      <p-progressSpinner></p-progressSpinner>
      <p>Učitavanje podataka za usklađivanje...</p>
    </div>

    <!-- Reconciliation Data -->
    <div *ngIf="!loading && reconciliationData" class="reconciliation-content">
      
      <!-- Summary Card -->
      <p-card class="summary-card">
        <ng-template pTemplate="header">
          <div>
            <h3>Pregled Sesije</h3>
            <p>{{ data.session.facility?.name || 'N/A' }}</p>
          </div>
        </ng-template>
        
        <div class="summary-details">
          <div class="summary-row">
            <span class="label">Početni Float:</span>
            <span class="value amount">{{ formatAmount(reconciliationData.openingFloat) }}</span>
          </div>
          <div class="summary-row">
            <span class="label">Očekivani Cash:</span>
            <span class="value amount">{{ formatAmount(reconciliationData.expectedCash) }}</span>
          </div>
          <div class="summary-row">
            <span class="label">Stvarni Cash:</span>
            <span class="value amount">{{ formatAmount(reconciliationData.actualCash) }}</span>
          </div>
          <div class="summary-row variance-row">
            <span class="label">Variance:</span>
            <span class="value" [ngClass]="'severity-' + getVarianceSeverity(reconciliationData.variance)">
              <i class="pi" [ngClass]="getVarianceIcon(reconciliationData.variance)"></i>
              {{ formatAmount(reconciliationData.variance) }}
            </span>
          </div>
        </div>
      </p-card>

      <!-- Sales Summary -->
      <p-card class="sales-summary-card">
        <ng-template pTemplate="header">
          <h3>Pregled Prodaja</h3>
        </ng-template>
        
        <div class="sales-details">
          <div class="sales-row">
            <span class="label">Ukupne Prodaje:</span>
            <span class="value amount">{{ formatAmount(reconciliationData.summary.totalSales) }}</span>
          </div>
          <div class="sales-row">
            <span class="label">Ukupni Refundovi:</span>
            <span class="value amount">{{ formatAmount(reconciliationData.summary.totalRefunds) }}</span>
          </div>
          <div class="sales-row net-row">
            <span class="label">Neto Prodaje:</span>
            <span class="value amount">{{ formatAmount(reconciliationData.summary.netSales) }}</span>
          </div>
        </div>
      </p-card>

      <!-- Payment Methods -->
      <p-card class="payment-methods-card">
        <ng-template pTemplate="header">
          <h3>Plaćanja po Metodama</h3>
        </ng-template>
        
        <div class="payment-methods">
          <div 
            *ngFor="let method of getPaymentMethods()" 
            class="payment-method-row">
            <div class="method-info">
              <i class="pi" [ngClass]="getPaymentMethodIcon(method.key)" class="method-icon"></i>
              <span class="method-name">{{ getPaymentMethodText(method.key) }}</span>
            </div>
            <span class="method-amount amount">{{ formatAmount(method.value) }}</span>
          </div>
        </div>
      </p-card>

      <!-- Cash Flow -->
      <p-card class="cash-flow-card">
        <ng-template pTemplate="header">
          <h3>Cash Flow</h3>
        </ng-template>
        
        <div class="cash-flow-details">
          <div class="flow-row">
            <span class="label">Početni Float:</span>
            <span class="value amount">{{ formatAmount(reconciliationData.summary.cashFlow.opening) }}</span>
          </div>
          <div class="flow-row">
            <span class="label">Cash Prodaje:</span>
            <span class="value amount">{{ formatAmount(reconciliationData.summary.cashFlow.sales) }}</span>
          </div>
          <div class="flow-row">
            <span class="label">Cash Refundovi:</span>
            <span class="value amount">{{ formatAmount(reconciliationData.summary.cashFlow.refunds) }}</span>
          </div>
          <div class="flow-row">
            <span class="label">Očekivani Cash:</span>
            <span class="value amount">{{ formatAmount(reconciliationData.summary.cashFlow.expected) }}</span>
          </div>
          <div class="flow-row">
            <span class="label">Stvarni Cash:</span>
            <span class="value amount">{{ formatAmount(reconciliationData.summary.cashFlow.actual) }}</span>
          </div>
          <div class="flow-row variance-row">
            <span class="label">Variance:</span>
            <span class="value" [ngClass]="'severity-' + getVarianceSeverity(reconciliationData.summary.cashFlow.variance)">
              <i class="pi" [ngClass]="getVarianceIcon(reconciliationData.summary.cashFlow.variance)"></i>
              {{ formatAmount(reconciliationData.summary.cashFlow.variance) }}
            </span>
          </div>
        </div>
      </p-card>
    </div>

    <!-- Error State -->
    <div *ngIf="!loading && !reconciliationData" class="error-state">
      <p-card class="error-card">
        <div class="error-content">
          <i class="pi pi-exclamation-triangle error-icon"></i>
          <h3>Greška pri učitavanju podataka</h3>
          <p>Nije moguće učitati podatke za usklađivanje</p>
        </div>
      </p-card>
    </div>
  </div>

  <!-- Dialog Actions -->
  <div class="dialog-actions">
    <p-button 
      label="Zatvori" 
      icon="pi pi-times" 
      (onClick)="close()"
      severity="secondary"
      [text]="true">
    </p-button>
  </div>
</div>
