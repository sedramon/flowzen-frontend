<div class="cash-counting-dialog">
  <!-- Dialog Content -->
  <div class="dialog-content">
    
    <!-- Session Info -->
    <p-card class="session-info-card">
      <div class="session-details">
        <div class="detail-row">
          <span class="label">Lokacija:</span>
          <span class="value">{{ data.session.facility?.name || 'N/A' }}</span>
        </div>
        <div class="detail-row">
          <span class="label">O훾ekivani Cash:</span>
          <span class="value amount">{{ formatAmount(data.session.expectedCash) }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Po훾etni Float:</span>
          <span class="value amount">{{ formatAmount(data.session.openingFloat) }}</span>
        </div>
      </div>
    </p-card>

    <!-- Counting Form -->
    <form [formGroup]="countingForm" (ngSubmit)="countCash()">
      <p-floatLabel class="full-width">
        <p-inputNumber 
          formControlName="countedCash" 
          inputId="countedCash"
          [min]="0"
          [step]="1"
          mode="decimal"
          [minFractionDigits]="0"
          [maxFractionDigits]="0"
          styleClass="full-width">
        </p-inputNumber>
        <label for="countedCash">Brojani Cash (RSD)</label>
      </p-floatLabel>
      <small class="p-error" *ngIf="countingForm.get('countedCash')?.hasError('required') && countingForm.get('countedCash')?.touched">
        {{ getErrorMessage('countedCash') }}
      </small>
      <small class="p-error" *ngIf="countingForm.get('countedCash')?.hasError('min') && countingForm.get('countedCash')?.touched">
        {{ getErrorMessage('countedCash') }}
      </small>
    </form>

    <!-- Counting Result -->
    <div *ngIf="countingResult" class="counting-result">
      <p-card class="result-card">
        <ng-template pTemplate="header">
          <h3>Rezultat Brojanja</h3>
        </ng-template>
        
        <div class="result-details">
          <div class="result-row">
            <span class="label">O훾ekivani Cash:</span>
            <span class="value">{{ formatAmount(countingResult.expectedCash) }}</span>
          </div>
          <div class="result-row">
            <span class="label">Brojani Cash:</span>
            <span class="value">{{ formatAmount(countingResult.countedCash) }}</span>
          </div>
          <div class="result-row variance-row">
            <span class="label">Variance:</span>
            <span class="value" [ngClass]="'severity-' + getVarianceStatusSeverity(countingResult.status)">
              <i class="pi" [ngClass]="getVarianceIcon(countingResult.variance)"></i>
              {{ formatAmount(countingResult.variance) }}
            </span>
          </div>
          <div class="result-row">
            <span class="label">Procenat Variance:</span>
            <span class="value" [ngClass]="'severity-' + getVarianceStatusSeverity(countingResult.status)">
              {{ countingResult.variancePercentage.toFixed(2) }}%
            </span>
          </div>
          <div class="result-row status-row">
            <span class="label">Status:</span>
            <p-tag 
              [value]="getVarianceStatusText(countingResult.status)"
              [severity]="getVarianceStatusSeverity(countingResult.status)"
              class="status-chip">
            </p-tag>
          </div>
        </div>

        <!-- Recommendations -->
        <div *ngIf="countingResult.recommendations && countingResult.recommendations.length > 0" class="recommendations">
          <h4>Preporuke:</h4>
          <ul>
            <li *ngFor="let rec of countingResult.recommendations">{{ rec }}</li>
          </ul>
        </div>
      </p-card>
    </div>
  </div>

  <!-- Dialog Actions -->
  <div class="dialog-actions">
    <p-button 
      label="Otka탑i" 
      icon="pi pi-times" 
      (onClick)="cancel()"
      [disabled]="processing"
      severity="secondary"
      [text]="true">
    </p-button>
    
    <p-button 
      label="{{ processing ? 'Brojanje...' : 'Broj Cash' }}" 
      icon="pi pi-calculator" 
      (onClick)="countCash()"
      [disabled]="countingForm.invalid || processing"
      [loading]="processing"
      severity="secondary">
    </p-button>

    <p-button 
      *ngIf="countingResult"
      label="{{ processing ? 'Verifikacija...' : 'Verifikuj' }}" 
      icon="pi pi-check-circle" 
      (onClick)="verifyCount()"
      [disabled]="processing"
      [loading]="processing"
      severity="primary">
    </p-button>
  </div>
</div>
