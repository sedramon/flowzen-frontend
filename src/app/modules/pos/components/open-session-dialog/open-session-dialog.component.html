<div class="open-session-dialog">
  <!-- Dialog Header -->
  <div class="dialog-header">
    <div class="header-content">
      <mat-icon class="header-icon">account_balance_wallet</mat-icon>
      <h2 class="dialog-title">Otvaranje Cash Sesije</h2>
    </div>
  </div>

  <!-- Dialog Content -->
  <div class="dialog-content">
    <form [formGroup]="openSessionForm" (ngSubmit)="openSession()">
      
      <!-- Facility Selection -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Lokacija</mat-label>
        <mat-select formControlName="facility" required>
            <mat-option *ngFor="let facility of data.facilities" [value]="facility._id">
            {{ facility.name }}
          </mat-option>
        </mat-select>
        <mat-icon matSuffix>location_on</mat-icon>
        <mat-error *ngIf="openSessionForm.get('facility')?.hasError('required')">
          {{ getErrorMessage('facility') }}
        </mat-error>
      </mat-form-field>

      <!-- Opening Float -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Početni Float (RSD)</mat-label>
        <input 
          matInput 
          type="number" 
          formControlName="openingFloat" 
          placeholder="0"
          min="0"
          step="1">
        <mat-icon matSuffix>attach_money</mat-icon>
        <mat-error *ngIf="openSessionForm.get('openingFloat')?.hasError('required')">
          {{ getErrorMessage('openingFloat') }}
        </mat-error>
        <mat-error *ngIf="openSessionForm.get('openingFloat')?.hasError('min')">
          {{ getErrorMessage('openingFloat') }}
        </mat-error>
      </mat-form-field>

      <!-- Note -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Napomena (opciono)</mat-label>
        <textarea 
          matInput 
          formControlName="note" 
          placeholder="Dodatne napomene..."
          rows="3">
        </textarea>
        <mat-icon matSuffix>note</mat-icon>
      </mat-form-field>

      <!-- Preview -->
      <div class="preview-section" *ngIf="openSessionForm.get('openingFloat')?.value">
        <div class="preview-card">
          <h4>Pregled Sesije</h4>
          <div class="preview-details">
            <div class="preview-row">
              <span class="label">Lokacija:</span>
              <span class="value">
                {{ getSelectedFacilityName() }}
              </span>
            </div>
            <div class="preview-row">
              <span class="label">Početni Float:</span>
              <span class="value amount">{{ formatAmount(openSessionForm.get('openingFloat')?.value) }}</span>
            </div>
            <div class="preview-row" *ngIf="openSessionForm.get('note')?.value">
              <span class="label">Napomena:</span>
              <span class="value">{{ openSessionForm.get('note')?.value }}</span>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>

  <!-- Dialog Actions -->
  <div class="dialog-actions">
    <button 
      mat-button 
      type="button" 
      (click)="cancel()"
      [disabled]="processing"
      class="cancel-button">
      <mat-icon>close</mat-icon>
      Otkaži
    </button>
    
    <button 
      mat-raised-button 
      color="primary" 
      type="submit"
      (click)="openSession()"
      [disabled]="openSessionForm.invalid || processing"
      class="action-button">
      <mat-spinner *ngIf="processing" diameter="20" class="button-spinner"></mat-spinner>
      <mat-icon *ngIf="!processing">account_balance_wallet</mat-icon>
      {{ processing ? 'Otvaranje...' : 'Otvori Sesiju' }}
    </button>
  </div>
</div>
