<div class="client-detail-container">
  <!-- Navigation Sidebar -->
  <div class="nav-sidebar">
    <p-card class="nav-card">
      <ng-template pTemplate="header">
        <div class="nav-header">
          <i class="pi pi-bars"></i>
          <h3>Navigacija</h3>
        </div>
      </ng-template>

      <div class="nav-buttons">
        <p-button 
          icon="pi pi-info-circle" 
          label="Detalji klijenta"
          [text]="selectedSection === 'details'"
          [raised]="selectedSection !== 'details'"
          (onClick)="selectSection('details')"
          class="nav-button">
        </p-button>

        <p-button 
          icon="pi pi-receipt" 
          label="Računi klijenta"
          [text]="selectedSection === 'bills'"
          [raised]="selectedSection !== 'bills'"
          (onClick)="selectSection('bills')"
          class="nav-button">
        </p-button>

        <p-button 
          icon="pi pi-calendar" 
          label="Termini klijenta"
          [text]="selectedSection === 'appointments'"
          [raised]="selectedSection !== 'appointments'"
          (onClick)="selectSection('appointments')"
          class="nav-button">
        </p-button>

        <p-button 
          icon="pi pi-comment" 
          label="Napomene o klijentu"
          [text]="selectedSection === 'remarks'"
          [raised]="selectedSection !== 'remarks'"
          (onClick)="selectSection('remarks')"
          class="nav-button">
        </p-button>
      </div>
    </p-card>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <p-card class="content-card">
      <!-- Header with Back Button and Title -->
      <ng-template pTemplate="header">
        <div class="content-header">
          <p-button 
            icon="pi pi-arrow-left" 
            [rounded]="true"
            [text]="true"
            (onClick)="goBack()"
            class="back-btn">
          </p-button>
          
          <div class="title-section">
            <h2>{{ sectionTitle }}</h2>
          </div>
        </div>
      </ng-template>

      <!-- Content Sections -->
      <ng-container *ngIf="client">
        <ng-container [ngSwitch]="selectedSection">
          
          <!-- Details Section -->
          <div *ngSwitchCase="'details'" class="details-section">
            <div class="form-fields">
              <p-floatLabel>
                <input 
                  pInputText 
                  id="firstName" 
                  [(ngModel)]="client.firstName" 
                  (ngModelChange)="hasChanged = true"
                  class="input-field" />
                <label for="firstName">Ime klijenta</label>
              </p-floatLabel>

              <p-floatLabel>
                <input 
                  pInputText 
                  id="lastName" 
                  [(ngModel)]="client.lastName" 
                  (ngModelChange)="hasChanged = true"
                  class="input-field" />
                <label for="lastName">Prezime klijenta</label>
              </p-floatLabel>

              <p-floatLabel>
                <input 
                  pInputText 
                  id="address" 
                  [(ngModel)]="client.address" 
                  (ngModelChange)="hasChanged = true"
                  class="input-field" />
                <label for="address">Adresa klijenta</label>
              </p-floatLabel>

              <p-floatLabel>
                <input 
                  pInputText 
                  id="email" 
                  [(ngModel)]="client.contactEmail" 
                  (ngModelChange)="hasChanged = true"
                  class="input-field" />
                <label for="email">Email klijenta</label>
              </p-floatLabel>

              <p-floatLabel>
                <input 
                  pInputText 
                  id="phone" 
                  [(ngModel)]="client.contactPhone" 
                  (ngModelChange)="hasChanged = true"
                  class="input-field" />
                <label for="phone">Telefon klijenta</label>
              </p-floatLabel>
            </div>

            <!-- User Connection Card -->
            <div class="user-connection-card">
              <div class="connection-header">
                <i class="pi" [ngClass]="client.user ? 'pi-user' : 'pi-user-plus'"></i>
                <h3>Povezivanje sa User nalogom</h3>
              </div>

              <p-divider></p-divider>

              <!-- Connected User Section -->
              <div *ngIf="client.user && connectedUser" class="connected-user">
                <div class="connected-label">
                  <strong>User nalog</strong>
                </div>
                <div class="user-info">
                  <div class="user-details">
                    <span class="user-name">{{ connectedUser.name }}</span>
                    <span class="user-email">{{ connectedUser.email }}</span>
                  </div>
                </div>
                
                <div class="user-actions">
                  <p-button 
                    icon="pi pi-link" 
                    label="Diskonektuj nalog"
                    severity="danger"
                    [outlined]="true"
                    [rounded]="true"
                    (onClick)="disconnectUser()">
                  </p-button>
                  
                  <p-button 
                    icon="pi pi-sync" 
                    label="Promeni nalog"
                    [outlined]="true"
                    [rounded]="true"
                    (onClick)="userMenu.toggle($event)"
                    [disabled]="availableUsers.length === 0">
                  </p-button>
                </div>
              </div>

              <p-menu #userMenu [model]="userMenuItems" [popup]="true" appendTo="body"></p-menu>

              <!-- Loading Section -->
              <div *ngIf="!client.user && isLoadingUsers" class="loading-section">
                <p-progressSpinner styleClass="w-4rem h-4rem" strokeWidth="4"></p-progressSpinner>
                <span>Učitavanje korisnika...</span>
              </div>

              <!-- Select User Section -->
              <div *ngIf="!client.user && !isLoadingUsers && availableUsers.length > 0" class="select-user-section">
                <p class="select-label">Izaberi User nalog sa kojim želiš da povežeš ovog klijenta:</p>
                <p-button 
                  icon="pi pi-user-plus" 
                  [label]="'Izaberi User nalog (' + availableUsers.length + ' dostupno)'"
                  [rounded]="true"
                  (onClick)="userMenu.toggle($event)">
                </p-button>
              </div>

              <!-- No Users Warning -->
              <div *ngIf="!client.user && !isLoadingUsers && availableUsers.length === 0 && allUsers.length > 0" class="no-users-warning">
                <i class="pi pi-exclamation-triangle"></i>
                <p>Svi User nalozi su već povezani sa drugim klijentima</p>
              </div>
            </div>

            <!-- Save Button -->
            <div class="save-section">
              <p-button 
                icon="pi pi-save" 
                label="Sačuvaj"
                [rounded]="true"
                (onClick)="saveClient()"
                [disabled]="!hasChanged"
                class="save-btn">
              </p-button>
            </div>
          </div>

          <!-- Bills Section -->
          <div *ngSwitchCase="'bills'" class="section-placeholder">
            <i class="pi pi-receipt"></i>
            <h2>Računi</h2>
            <p>Računi klijenta će biti prikazani ovde</p>
          </div>

          <!-- Appointments Section -->
          <div *ngSwitchCase="'appointments'" class="section-placeholder">
            <i class="pi pi-calendar"></i>
            <h2>Termini</h2>
            <p>Budući i prošli termini će biti prikazani ovde</p>
          </div>

          <!-- Remarks Section -->
          <div *ngSwitchCase="'remarks'" class="section-placeholder">
            <i class="pi pi-comment"></i>
            <h2>Napomene</h2>
            <p>Napomene o klijentu će biti prikazane ovde</p>
          </div>

        </ng-container>
      </ng-container>
    </p-card>
  </div>
</div>

<!-- Toast for notifications -->
<p-toast position="top-right"></p-toast>
