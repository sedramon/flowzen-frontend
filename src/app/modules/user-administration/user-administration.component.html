<div class="user-admin-container">
  <!-- Users Section -->
  <p-card class="users-card">
    <ng-template pTemplate="header">
      <div class="card-header">
        <div class="header-content">
          <i class="pi pi-users"></i>
          <div class="header-text">
            <h2>Korisnici</h2>
            <p>Upravljajte i pregledajte sve registrovane korisnike sa njihovim detaljima.</p>
          </div>
        </div>
        <p-button 
          icon="pi pi-plus" 
          label="Dodaj korisnika"
          [rounded]="true"
          (onClick)="openAddUserDialog()"
          class="submit-btn">
        </p-button>
      </div>
    </ng-template>

    <p-table 
      [value]="users" 
      [paginator]="true" 
      [rows]="10" 
      [rowsPerPageOptions]="[5, 10, 25]"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Prikazano {first} do {last} od {totalRecords} korisnika"
      [tableStyle]="{ 'min-width': '50rem' }"
      styleClass="p-datatable-sm"
      [globalFilterFields]="['name', 'email', 'role.name']">
      
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="name">
            Ime <p-sortIcon field="name"></p-sortIcon>
          </th>
          <th pSortableColumn="email">
            Email <p-sortIcon field="email"></p-sortIcon>
          </th>
          <th pSortableColumn="role.name">
            Uloga <p-sortIcon field="role.name"></p-sortIcon>
          </th>
          <th class="actions-column">Akcije</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-user>
        <tr (click)="openEditUserDialog(user)" class="table-row">
          <td>
            <div class="user-cell">
              <p-avatar 
                image="user-profile-image.png"
                shape="circle"
                size="normal">
              </p-avatar>
              <span class="user-name">{{ user.name }}</span>
            </div>
          </td>
          <td>{{ user.email }}</td>
          <td>
            <p-tag 
              [value]="user.role.name" 
              severity="info"
              [rounded]="true">
            </p-tag>
          </td>
          <td class="actions-column">
            <div class="action-buttons">
              <p-button 
                icon="pi pi-pencil" 
                [text]="true"
                [rounded]="true"
                severity="warning"
                pTooltip="Izmeni"
                tooltipPosition="top"
                (onClick)="openEditUserDialog(user); $event.stopPropagation()">
              </p-button>
              <p-button 
                icon="pi pi-trash" 
                [text]="true"
                [rounded]="true"
                severity="danger"
                pTooltip="Obriši"
                tooltipPosition="top"
                (onClick)="deleteUser(user); $event.stopPropagation()">
              </p-button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="4" class="empty-message">
            <div class="empty-state">
              <i class="pi pi-users"></i>
              <p>Nema pronađenih korisnika.</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <!-- Roles Section -->
  <p-card class="roles-card">
    <ng-template pTemplate="header">
      <div class="card-header">
        <div class="header-content">
          <i class="pi pi-shield"></i>
          <div class="header-text">
            <h2>Uloge</h2>
            <p>Pregledajte i upravljajte ulogama korisnika i njihovim dozvolama.</p>
          </div>
        </div>
        <p-button 
          icon="pi pi-plus" 
          label="Dodaj ulogu"
          [rounded]="true"
          (onClick)="openAddRoleDialog()"
          class="submit-btn">
        </p-button>
      </div>
    </ng-template>

    <p-table 
      [value]="roles" 
      [paginator]="true" 
      [rows]="10" 
      [rowsPerPageOptions]="[5, 10, 25]"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Prikazano {first} do {last} od {totalRecords} uloga"
      [tableStyle]="{ 'min-width': '50rem' }"
      styleClass="p-datatable-sm"
      [globalFilterFields]="['name']">
      
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="name">
            Naziv uloge <p-sortIcon field="name"></p-sortIcon>
          </th>
          <th class="actions-column">Akcije</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-role>
        <tr (click)="openEditRoleDialog(role)" class="table-row">
          <td>
            <p-tag 
              [value]="role.name" 
              severity="secondary"
              [rounded]="true">
            </p-tag>
          </td>
          <td class="actions-column">
            <div class="action-buttons">
              <p-button 
                icon="pi pi-pencil" 
                [text]="true"
                [rounded]="true"
                severity="warning"
                pTooltip="Izmeni"
                tooltipPosition="top"
                (onClick)="openEditRoleDialog(role); $event.stopPropagation()">
              </p-button>
              <p-button 
                icon="pi pi-trash" 
                [text]="true"
                [rounded]="true"
                severity="danger"
                pTooltip="Obriši"
                tooltipPosition="top"
                (onClick)="deleteRole(role); $event.stopPropagation()">
              </p-button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="2" class="empty-message">
            <div class="empty-state">
              <i class="pi pi-shield"></i>
              <p>Nema pronađenih uloga.</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>

<!-- Toast for notifications -->
<p-toast position="top-right"></p-toast>