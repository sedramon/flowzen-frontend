<div class="dialog-container">
  <h2 mat-dialog-title>Edit Role</h2>
  
  <div mat-dialog-content class="dialog-content" [formGroup]="roleForm">
    <!-- Role Name Input -->
    <mat-form-field appearance="outline" style="width: 100%" class="mat-form-field-css">
      <mat-label>Role Name</mat-label>
      <input matInput formControlName="name">
      <mat-error *ngIf="roleForm.controls['name'].hasError('required')">Name is required</mat-error>
    </mat-form-field>

    <!-- Available Scopes Organized by Modules -->
    <div class="scopes-section">
      <div class="scopes-section-header">
        <div class="scopes-title-section">
          <mat-icon class="scopes-icon">security</mat-icon>
          <span class="scopes-title">Available Scopes</span>
          <span class="scopes-counter" *ngIf="totalSelectedCount > 0">
            ({{ totalSelectedCount }} / {{ allScopes.length }} selected)
          </span>
        </div>
        <div class="scopes-global-actions">
          <button 
            mat-stroked-button 
            type="button" 
            (click)="selectAllScopes()" 
            [disabled]="allSelected || allScopes.length === 0"
            class="global-select-btn">
            <mat-icon>select_all</mat-icon>
            <span>Select All</span>
          </button>
          <button 
            mat-stroked-button 
            type="button" 
            (click)="deselectAllScopes()" 
            [disabled]="totalSelectedCount === 0"
            class="global-deselect-btn">
            <mat-icon>deselect</mat-icon>
            <span>Deselect All</span>
          </button>
        </div>
      </div>

      <!-- Modules Grid -->
      <div class="modules-grid" formGroupName="modules">
        <mat-card *ngFor="let module of uniqueModules" class="module-card">
          <mat-card-header class="module-card-header">
            <div class="module-header-content">
              <mat-icon class="module-icon">{{ getModuleIcon(module) }}</mat-icon>
              <mat-card-title class="module-title">{{ getModuleDisplayName(module) }}</mat-card-title>
              <span class="module-count">({{ getModuleActions(module).length }})</span>
            </div>
            <div class="module-actions">
              <button 
                mat-icon-button 
                type="button"
                (click)="selectAllForModule(module)" 
                [disabled]="allSelectedForModule(module)"
                [matTooltip]="'Select all ' + getModuleDisplayName(module) + ' actions'"
                matTooltipPosition="above"
                class="module-select-btn">
                <mat-icon>select_all</mat-icon>
              </button>
              <button 
                mat-icon-button 
                type="button"
                (click)="deselectAllForModule(module)" 
                [disabled]="!allSelectedForModule(module) && !someSelectedForModule(module)"
                [matTooltip]="'Deselect all ' + getModuleDisplayName(module) + ' actions'"
                matTooltipPosition="above"
                class="module-deselect-btn">
                <mat-icon>deselect</mat-icon>
              </button>
            </div>
          </mat-card-header>
          
          <mat-card-content class="module-card-content">
            <div class="actions-grid" [formGroupName]="module">
              <mat-checkbox 
                *ngFor="let action of getModuleActions(module)"
                [formControlName]="action"
                [matTooltip]="getActionTooltip(action)"
                matTooltipPosition="above"
                class="action-checkbox">
                <mat-icon class="action-icon">
                  {{ getActionIcon(action) }}
                </mat-icon>
                <span class="action-text">{{ getActionDisplayText(action) }}</span>
              </mat-checkbox>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>

  <div mat-dialog-actions fxLayout="row" fxLayoutAlign="space-between center" class="mat-dialog-buttons">
    <button mat-raised-button color="primary" (click)="save()" [disabled]="roleForm.controls['name'].invalid || totalSelectedCount === 0">
      <mat-icon>save</mat-icon>
      <span>Save Role</span>
    </button>
    <button mat-raised-button (click)="cancel()">
      <mat-icon>cancel</mat-icon>
      <span>Cancel</span>
    </button>
  </div>
</div>
