<div [@dialogPop] class="admin-dialog admin-dialog--large">
  <!-- Header -->
  <div class="admin-dialog__header">
    <div class="admin-dialog__icon">
      <i class="pi pi-shield"></i>
    </div>
    <div class="admin-dialog__title">
      <h2>Nova uloga</h2>
      <p>Kreiranje nove uloge sa dozvolama</p>
    </div>
  </div>
  
  <!-- Content -->
  <div class="admin-dialog__content">
    <form [formGroup]="roleForm">
      <!-- Role Name - standalone -->
      <div class="form-field full-width" style="margin-bottom: 1.5rem;">
        <label class="field-label">
          <i class="pi pi-tag"></i>
          Naziv uloge
        </label>
        <input 
          pInputText 
          formControlName="name" 
          placeholder="Unesite naziv uloge"
          class="p-inputtext-lg w-full" />
        <small class="p-error" *ngIf="roleForm.controls['name'].touched && roleForm.controls['name'].hasError('required')">
          Naziv uloge je obavezan
        </small>
      </div>

      <!-- Available Scopes Section -->
      <div class="scopes-section">
        <div class="scopes-section-header">
          <div class="scopes-title-section">
            <i class="pi pi-lock"></i>
            <span class="scopes-title">Dostupne dozvole</span>
            <span class="scopes-counter" *ngIf="totalSelectedCount > 0">
              ({{ totalSelectedCount }} / {{ allScopes.length }} izabrano)
            </span>
          </div>
          <div class="scopes-global-actions">
            <p-button 
              label="Izaberi sve" 
              icon="pi pi-check-square"
              [outlined]="true"
              size="small"
              (onClick)="selectAllScopes()" 
              [disabled]="allSelected || allScopes.length === 0">
            </p-button>
            <p-button 
              label="Poništi sve" 
              icon="pi pi-times"
              [outlined]="true"
              size="small"
              severity="secondary"
              (onClick)="deselectAllScopes()" 
              [disabled]="totalSelectedCount === 0">
            </p-button>
          </div>
        </div>

        <!-- Modules Grid -->
        <div class="modules-grid" formGroupName="modules">
          <div *ngFor="let module of uniqueModules" class="module-card">
            <div class="module-card-header">
              <div class="module-header-content">
                <i class="pi {{ getModuleIcon(module) }} module-icon"></i>
                <span class="module-title">{{ getModuleDisplayName(module) }}</span>
                <span class="module-count">({{ getModuleActions(module).length }})</span>
              </div>
              <div class="module-actions">
                <p-button 
                  icon="pi pi-check-square" 
                  [text]="true"
                  size="small"
                  (onClick)="selectAllForModule(module)" 
                  [disabled]="allSelectedForModule(module)"
                  pTooltip="Izaberi sve {{ getModuleDisplayName(module) }} akcije"
                  tooltipPosition="top">
                </p-button>
                <p-button 
                  icon="pi pi-times" 
                  [text]="true"
                  size="small"
                  severity="secondary"
                  (onClick)="deselectAllForModule(module)" 
                  [disabled]="!allSelectedForModule(module) && !someSelectedForModule(module)"
                  pTooltip="Poništi sve {{ getModuleDisplayName(module) }} akcije"
                  tooltipPosition="top">
                </p-button>
              </div>
            </div>
            
            <div class="module-card-content">
              <div class="actions-grid" [formGroupName]="module">
                <div *ngFor="let action of getModuleActions(module)" class="action-checkbox-wrapper">
                  <p-checkbox 
                    [formControlName]="action"
                    [binary]="true"
                    [inputId]="module + '_' + action">
                  </p-checkbox>
                  <label [for]="module + '_' + action" class="action-label" [pTooltip]="getActionTooltip(action)" tooltipPosition="top">
                    <i class="pi {{ getActionIcon(action) }} action-icon"></i>
                    <span class="action-text">{{ getActionDisplayText(action) }}</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>

  <!-- Actions -->
  <div class="admin-dialog__actions">
    <p-button 
      label="Odustani" 
      icon="pi pi-times"
      [text]="true"
      (onClick)="closeDialog()">
    </p-button>
    <p-button 
      label="Sačuvaj ulogu" 
      icon="pi pi-save"
      (onClick)="createRole()" 
      [disabled]="roleForm.controls['name'].invalid || totalSelectedCount === 0">
    </p-button>
  </div>
</div>
